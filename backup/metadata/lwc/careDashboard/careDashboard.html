<template>
  <div class="dashboard-container">
    <!-- Header Section -->
    <header class="dashboard-header slds-m-bottom_medium">
      <h1 class="slds-text-heading_large">Care Home Operations Dashboard</h1>
      <p class="slds-text-body_medium text-muted">
        Real-time pipeline and occupancy metrics
      </p>
    </header>

    <template if:true={isLoading}>
      <lightning-spinner
        alternative-text="Loading..."
        size="medium"
      ></lightning-spinner>
    </template>

    <template if:false={isLoading}>
      <div class="slds-grid slds-wrap slds-gutters">
        <!-- Sales Pipeline Card -->
        <div
          class="slds-col slds-size_1-of-1 slds-medium-size_7-of-12 slds-m-bottom_medium"
        >
          <article class="dashboard-card glass-card pipeline-card">
            <div class="card-header">
              <lightning-icon
                icon-name="standard:opportunity"
                size="small"
                class="slds-m-right_small"
              ></lightning-icon>
              <h2 class="slds-text-heading_medium">Sales Pipeline</h2>
            </div>
            <div class="card-body pipeline-body">
              <template for:each={pipelineData} for:item="item">
                <div key={item.label} class="pipeline-row">
                  <div class="row-label">{item.label}</div>
                  <div class="row-bar-container">
                    <div class="row-bar" style={item.barStyle}>
                      <span class="bar-value">{item.value}</span>
                    </div>
                  </div>
                </div>
              </template>
            </div>
          </article>
        </div>

        <!-- Occupancy Overview Card -->
        <div
          class="slds-col slds-size_1-of-1 slds-medium-size_5-of-12 slds-m-bottom_medium"
        >
          <article class="dashboard-card glass-card occupancy-card">
            <div class="card-header">
              <lightning-icon
                icon-name="standard:home"
                size="small"
                class="slds-m-right_small"
              ></lightning-icon>
              <h2 class="slds-text-heading_medium">Room Occupancy</h2>
            </div>
            <div class="card-body occupancy-body">
              <div class="chart-container">
                <svg viewBox="0 0 36 36" class="circular-chart">
                  <path
                    class="circle-bg"
                    d="M18 2.0845
                                        a 15.9155 15.9155 0 0 1 0 31.831
                                        a 15.9155 15.9155 0 0 1 0 -31.831"
                  />
                  <path
                    class="circle"
                    stroke-dasharray={occupancyDashArray}
                    d="M18 2.0845
                                        a 15.9155 15.9155 0 0 1 0 31.831
                                        a 15.9155 15.9155 0 0 1 0 -31.831"
                  />
                  <text x="18" y="20.35" class="percentage">
                    {occupancyRate}%
                  </text>
                </svg>
              </div>
              <div class="occupancy-stats">
                <div class="stat-item">
                  <span class="stat-label">Total Rooms</span>
                  <span class="stat-value">{totalRooms}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Occupied</span>
                  <span class="stat-value color-primary">{occupiedRooms}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Available</span>
                  <span class="stat-value color-success">{availableRooms}</span>
                </div>
              </div>
            </div>
          </article>
        </div>
      </div>

      <!-- Quick Insights -->
      <div class="slds-grid slds-wrap slds-gutters">
        <div class="slds-col slds-size_1-of-1">
          <div class="insight-strip glass-card">
            <div class="insight-item">
              <lightning-icon
                icon-name="utility:graph"
                size="xx-small"
                class="slds-m-right_x-small"
              ></lightning-icon>
              <span
                ><strong>Insight:</strong> Pipeline shows {totalPipeline} active
                enquiries. Focus on 'Qualification' stage to boost
                occupancy.</span
              >
            </div>
          </div>
        </div>
      </div>
    </template>
  </div>
</template>
